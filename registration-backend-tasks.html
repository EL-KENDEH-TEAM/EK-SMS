<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EK-SMS - Registration Backend Tasks</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      color: #1f2937;
      background-color: #f9fafb;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    
    header {
      margin-bottom: 40px;
      padding-bottom: 24px;
      border-bottom: 3px solid #1a365d;
    }
    
    .logo {
      font-size: 14px;
      font-weight: 600;
      color: #1a365d;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }
    
    h1 {
      font-size: 28px;
      font-weight: 700;
      color: #1a365d;
      margin-bottom: 8px;
    }
    
    .subtitle {
      font-size: 15px;
      color: #6b7280;
    }
    
    .meta {
      margin-top: 16px;
      font-size: 13px;
      color: #9ca3af;
    }
    
    .meta span {
      margin-right: 24px;
    }
    
    .overview {
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
    }
    
    .overview h2 {
      font-size: 18px;
      color: #1a365d;
      margin-bottom: 12px;
    }
    
    .overview p {
      color: #4b5563;
      margin-bottom: 12px;
    }
    
    .task {
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .task-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background-color: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .task-number {
      background-color: #1a365d;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    .task-title {
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
      flex: 1;
    }
    
    .task-estimate {
      font-size: 12px;
      color: #6b7280;
      background-color: #e5e7eb;
      padding: 4px 10px;
      border-radius: 12px;
    }
    
    .task-body {
      padding: 20px;
    }
    
    .task-section {
      margin-bottom: 20px;
    }
    
    .task-section:last-child {
      margin-bottom: 0;
    }
    
    .task-section-title {
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    
    .task-description {
      color: #4b5563;
      font-size: 14px;
    }
    
    .task-list {
      list-style: none;
      padding: 0;
    }
    
    .task-list li {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 6px 0;
      font-size: 14px;
      color: #4b5563;
    }
    
    .task-list li::before {
      content: "•";
      color: #1a365d;
      font-weight: bold;
    }
    
    .checkbox-list {
      list-style: none;
      padding: 0;
    }
    
    .checkbox-list li {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 0;
      font-size: 14px;
      color: #4b5563;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .checkbox-list li:last-child {
      border-bottom: none;
    }
    
    .checkbox-list input[type="checkbox"] {
      margin-top: 2px;
      width: 16px;
      height: 16px;
    }
    
    .code-block {
      background-color: #1f2937;
      color: #e5e7eb;
      padding: 16px;
      border-radius: 6px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      overflow-x: auto;
      margin: 8px 0;
    }
    
    .code-block pre {
      margin: 0;
      white-space: pre;
    }
    
    .file-path {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      color: #dc2626;
      background-color: #fef2f2;
      padding: 2px 8px;
      border-radius: 4px;
    }
    
    .dependency-tag {
      display: inline-block;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 4px;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    
    .dep-none {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .dep-task {
      background-color: #dbeafe;
      color: #1e40af;
    }
    
    .api-ref {
      background-color: #f3e8ff;
      color: #6b21a8;
    }
    
    .note {
      background-color: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      color: #1e40af;
      margin: 12px 0;
    }
    
    .warning {
      background-color: #fffbeb;
      border: 1px solid #fde68a;
      border-radius: 6px;
      padding: 12px 16px;
      font-size: 13px;
      color: #92400e;
      margin: 12px 0;
    }
    
    .progress-section {
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .progress-section h2 {
      font-size: 16px;
      color: #1a365d;
      margin-bottom: 16px;
    }
    
    .progress-bar-container {
      background-color: #e5e7eb;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    
    .progress-bar {
      background-color: #22c55e;
      height: 100%;
      width: 0%;
      transition: width 0.3s;
    }
    
    .progress-text {
      font-size: 13px;
      color: #6b7280;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 16px;
    }
    
    .summary-item {
      text-align: center;
      padding: 12px;
      background-color: #f9fafb;
      border-radius: 8px;
    }
    
    .summary-number {
      font-size: 24px;
      font-weight: 700;
      color: #1a365d;
    }
    
    .summary-label {
      font-size: 12px;
      color: #6b7280;
    }
    
    footer {
      text-align: center;
      padding: 40px 0;
      color: #9ca3af;
      font-size: 13px;
    }
    
    @media (max-width: 640px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }
      
      .task-header {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">EK-SMS</div>
      <h1>Registration Backend Tasks</h1>
      <p class="subtitle">Backend development tasks for the School Registration feature</p>
      <div class="meta">
        <span>Total Tasks: 10</span>
        <span>Estimated Time: 12-16 hours</span>
        <span>Reference: registration-api-contract.html</span>
      </div>
    </header>
    
    <!-- Progress Tracker -->
    <div class="progress-section">
      <h2>Progress Tracker</h2>
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-text"><span id="completedCount">0</span> of 10 tasks completed</div>
      
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-number">10</div>
          <div class="summary-label">Total Tasks</div>
        </div>
        <div class="summary-item">
          <div class="summary-number">6</div>
          <div class="summary-label">API Endpoints</div>
        </div>
        <div class="summary-item">
          <div class="summary-number">2</div>
          <div class="summary-label">Database Models</div>
        </div>
      </div>
    </div>
    
    <!-- Overview -->
    <div class="overview">
      <h2>Before You Start</h2>
      <p>Make sure you have:</p>
      <ul class="task-list">
        <li>Read the <strong>registration-api-contract.html</strong> document</li>
        <li>Read the <strong>registration-specification.html</strong> for business logic details</li>
        <li>Docker containers running (PostgreSQL on 5440, Redis on 6380)</li>
        <li>API virtual environment activated</li>
      </ul>
      <div class="note">
        <strong>Module Location:</strong> All code goes in <span class="file-path">apps/api/src/app/modules/school_applications/</span>
      </div>
    </div>
    
    <!-- Task 1 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">1</div>
        <div class="task-title">Create Module Structure</div>
        <div class="task-estimate">~30 min</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create the school_applications module folder with all required files following the standard module pattern.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-none">None - Start here</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Files to Create</div>
          <div class="code-block">
            <pre>apps/api/src/app/modules/school_applications/
├── __init__.py
├── models.py
├── schemas.py
├── repository.py
├── service.py
└── router.py</pre>
          </div>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Module folder created at correct path</li>
            <li><input type="checkbox" onchange="updateProgress()"> All 6 files created (can be empty with pass)</li>
            <li><input type="checkbox" onchange="updateProgress()"> __init__.py exports router</li>
            <li><input type="checkbox" onchange="updateProgress()"> Router registered in main app</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 2 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">2</div>
        <div class="task-title">Create Database Models</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create SQLAlchemy models for SchoolApplication and VerificationToken tables.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 1</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Models to Create</div>
          
          <p><strong>SchoolApplication</strong></p>
          <div class="code-block">
            <pre>class SchoolApplication(Base):
    __tablename__ = "school_applications"
    
    # Primary key
    id: UUID
    
    # School info
    school_name: str (max 200)
    year_established: int
    school_type: str (enum: public, private, mission)
    student_population: str (enum: under100, 100-300, 300-500, 500+)
    
    # Location
    country_code: str (2 chars)
    city: str (max 100)
    address: str (max 500)
    
    # School contact
    school_phone: str | None
    school_email: str | None
    
    # Principal
    principal_name: str
    principal_email: str
    principal_phone: str
    
    # Applicant
    applicant_is_principal: bool
    applicant_name: str | None
    applicant_email: str | None
    applicant_phone: str | None
    applicant_role: str | None
    admin_choice: str | None (enum: applicant, principal)
    
    # Details
    online_presence: JSON | None  # Array of {type, url}
    reasons: JSON  # Array of strings
    other_reason: str | None
    
    # Status tracking
    status: str (enum - see API contract)
    submitted_at: datetime
    applicant_verified_at: datetime | None
    principal_confirmed_at: datetime | None
    reviewed_at: datetime | None
    reviewed_by: UUID | None (FK to users)
    decision_reason: str | None
    
    # Audit
    created_at: datetime
    updated_at: datetime</pre>
          </div>
          
          <p><strong>VerificationToken</strong></p>
          <div class="code-block">
            <pre>class VerificationToken(Base):
    __tablename__ = "verification_tokens"
    
    id: UUID
    application_id: UUID (FK to school_applications)
    token: str (unique, indexed)
    token_type: str (enum: applicant_verification, principal_confirmation)
    expires_at: datetime
    used_at: datetime | None
    created_at: datetime</pre>
          </div>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> SchoolApplication model created with all fields</li>
            <li><input type="checkbox" onchange="updateProgress()"> VerificationToken model created with all fields</li>
            <li><input type="checkbox" onchange="updateProgress()"> Proper indexes on: status, applicant_email, principal_email, school_name+city</li>
            <li><input type="checkbox" onchange="updateProgress()"> Foreign key relationship defined</li>
            <li><input type="checkbox" onchange="updateProgress()"> Alembic migration created and runs successfully</li>
          </ul>
        </div>
        
        <div class="note">
          <strong>Important:</strong> These are platform-level tables (no school_id) since they exist before a school tenant is created.
        </div>
      </div>
    </div>
    
    <!-- Task 3 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">3</div>
        <div class="task-title">Create Pydantic Schemas</div>
        <div class="task-estimate">~1 hour</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create Pydantic schemas for request validation and response serialization. Must match the API contract exactly.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 1</span>
          <span class="dependency-tag api-ref">API Contract</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Schemas to Create</div>
          <ul class="task-list">
            <li><strong>SchoolApplicationCreate</strong> - Request body for POST /school-applications</li>
            <li><strong>SchoolApplicationResponse</strong> - Response after submission</li>
            <li><strong>VerifyApplicantRequest</strong> - Request body with token</li>
            <li><strong>VerifyApplicantResponse</strong> - Response after verification</li>
            <li><strong>ConfirmPrincipalRequest</strong> - Request body with token</li>
            <li><strong>ConfirmPrincipalResponse</strong> - Response after confirmation</li>
            <li><strong>ResendVerificationRequest</strong> - Request with application_id and email</li>
            <li><strong>ApplicationStatusResponse</strong> - Status check response</li>
            <li><strong>CountryListResponse</strong> - List of supported countries</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> All request schemas created with proper validation</li>
            <li><input type="checkbox" onchange="updateProgress()"> All response schemas created</li>
            <li><input type="checkbox" onchange="updateProgress()"> Enums created for school_type, student_population, status, etc.</li>
            <li><input type="checkbox" onchange="updateProgress()"> Conditional validation: applicant fields required if is_principal=false</li>
            <li><input type="checkbox" onchange="updateProgress()"> At least one of school_phone or school_email required</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 4 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">4</div>
        <div class="task-title">Create Repository Layer</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create database operations for SchoolApplication and VerificationToken. All operations must be async.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 2</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Methods to Implement</div>
          <p><strong>SchoolApplicationRepository</strong></p>
          <ul class="task-list">
            <li>create(db, data) → SchoolApplication</li>
            <li>get_by_id(db, id) → SchoolApplication | None</li>
            <li>get_by_applicant_email(db, email) → list[SchoolApplication]</li>
            <li>get_pending_by_school_and_city(db, name, city) → SchoolApplication | None</li>
            <li>update_status(db, id, status, **kwargs) → SchoolApplication</li>
            <li>get_expired_unverified(db, before_datetime) → list[SchoolApplication]</li>
          </ul>
          
          <p><strong>VerificationTokenRepository</strong></p>
          <ul class="task-list">
            <li>create(db, application_id, token_type, expires_at) → VerificationToken</li>
            <li>get_by_token(db, token) → VerificationToken | None</li>
            <li>mark_used(db, token) → VerificationToken</li>
            <li>delete_for_application(db, application_id, token_type) → None</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> All repository methods implemented</li>
            <li><input type="checkbox" onchange="updateProgress()"> All methods are async</li>
            <li><input type="checkbox" onchange="updateProgress()"> Proper error handling</li>
            <li><input type="checkbox" onchange="updateProgress()"> Unit tests written for each method</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 5 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">5</div>
        <div class="task-title">Setup Email Service</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create email service for sending verification and notification emails. Use templates for email content.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-none">Can start independently</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Implementation Details</div>
          <ul class="task-list">
            <li>Create email service in <span class="file-path">apps/api/src/app/core/email.py</span></li>
            <li>Use environment variables for SMTP configuration</li>
            <li>Create HTML templates for each email type</li>
            <li>Implement async email sending (don't block the request)</li>
          </ul>
          
          <p><strong>Email Templates Needed:</strong></p>
          <ul class="task-list">
            <li>applicant_verification.html</li>
            <li>principal_confirmation.html</li>
            <li>verification_reminder.html</li>
            <li>application_expired.html</li>
            <li>application_under_review.html</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Email service created with send_email method</li>
            <li><input type="checkbox" onchange="updateProgress()"> All 5 email templates created</li>
            <li><input type="checkbox" onchange="updateProgress()"> Templates use placeholders for dynamic content</li>
            <li><input type="checkbox" onchange="updateProgress()"> Email sending is async (background task)</li>
            <li><input type="checkbox" onchange="updateProgress()"> Fallback for development (log email instead of sending)</li>
          </ul>
        </div>
        
        <div class="warning">
          <strong>For Development:</strong> Use a console/log backend initially. Real SMTP can be configured later.
        </div>
      </div>
    </div>
    
    <!-- Task 6 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">6</div>
        <div class="task-title">Implement Service Layer - Submit Application</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Implement the business logic for submitting a new school application.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 3</span>
          <span class="dependency-tag dep-task">Task 4</span>
          <span class="dependency-tag dep-task">Task 5</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Business Logic</div>
          <ul class="task-list">
            <li>Validate no pending application exists for same applicant email + school</li>
            <li>Validate no pending application with same school name + city</li>
            <li>Create SchoolApplication record with status "awaiting_applicant_verification"</li>
            <li>Generate secure verification token (use secrets.token_urlsafe)</li>
            <li>Create VerificationToken record (expires in 72 hours)</li>
            <li>Send verification email to applicant</li>
            <li>Return application ID and status</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Duplicate application check works</li>
            <li><input type="checkbox" onchange="updateProgress()"> Application created with correct status</li>
            <li><input type="checkbox" onchange="updateProgress()"> Token generated and stored</li>
            <li><input type="checkbox" onchange="updateProgress()"> Verification email sent</li>
            <li><input type="checkbox" onchange="updateProgress()"> Proper error responses for edge cases</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 7 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">7</div>
        <div class="task-title">Implement Service Layer - Verification & Confirmation</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Implement verification and confirmation logic for applicant and principal.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 6</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Methods to Implement</div>
          
          <p><strong>verify_applicant(token)</strong></p>
          <ul class="task-list">
            <li>Validate token exists and not expired</li>
            <li>Validate token not already used</li>
            <li>Mark token as used</li>
            <li>If applicant IS principal: update status to "pending_review", send "under review" email</li>
            <li>If applicant is NOT principal: update status to "awaiting_principal_confirmation", create new token, send principal confirmation email</li>
          </ul>
          
          <p><strong>confirm_principal(token)</strong></p>
          <ul class="task-list">
            <li>Validate token exists and not expired</li>
            <li>Validate application is in correct state</li>
            <li>Mark token as used</li>
            <li>Update status to "pending_review"</li>
            <li>Send "under review" email to applicant</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Applicant verification works for both scenarios</li>
            <li><input type="checkbox" onchange="updateProgress()"> Principal confirmation works</li>
            <li><input type="checkbox" onchange="updateProgress()"> Expired tokens rejected</li>
            <li><input type="checkbox" onchange="updateProgress()"> Already used tokens rejected</li>
            <li><input type="checkbox" onchange="updateProgress()"> Correct emails sent at each step</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 8 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">8</div>
        <div class="task-title">Implement Service Layer - Resend & Status</div>
        <div class="task-estimate">~1 hour</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Implement resend verification and status check functionality.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 6</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Methods to Implement</div>
          
          <p><strong>resend_verification(application_id, email)</strong></p>
          <ul class="task-list">
            <li>Validate application exists</li>
            <li>Validate email matches applicant email</li>
            <li>Validate application not already verified</li>
            <li>Check rate limit (max 3 per hour) - use Redis</li>
            <li>Delete old token, create new one</li>
            <li>Send new verification email</li>
          </ul>
          
          <p><strong>get_status(application_id, email)</strong></p>
          <ul class="task-list">
            <li>Validate application exists</li>
            <li>Validate email matches (security check)</li>
            <li>Return status with progress steps</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Resend works and creates new token</li>
            <li><input type="checkbox" onchange="updateProgress()"> Rate limiting works (use Redis)</li>
            <li><input type="checkbox" onchange="updateProgress()"> Status returns correct progress steps</li>
            <li><input type="checkbox" onchange="updateProgress()"> Email validation prevents unauthorized access</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 9 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">9</div>
        <div class="task-title">Create API Endpoints</div>
        <div class="task-estimate">~1.5 hours</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create all API endpoints in the router, connecting to the service layer.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 6</span>
          <span class="dependency-tag dep-task">Task 7</span>
          <span class="dependency-tag dep-task">Task 8</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Endpoints to Create</div>
          <ul class="task-list">
            <li>POST /school-applications</li>
            <li>POST /school-applications/verify-applicant</li>
            <li>POST /school-applications/confirm-principal</li>
            <li>POST /school-applications/resend-verification</li>
            <li>GET /school-applications/{id}/status</li>
            <li>GET /countries</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> All 6 endpoints created</li>
            <li><input type="checkbox" onchange="updateProgress()"> Request/response schemas match API contract</li>
            <li><input type="checkbox" onchange="updateProgress()"> Proper HTTP status codes returned</li>
            <li><input type="checkbox" onchange="updateProgress()"> Error responses match contract format</li>
            <li><input type="checkbox" onchange="updateProgress()"> Endpoints documented with OpenAPI (FastAPI auto-generates)</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Task 10 -->
    <div class="task">
      <div class="task-header">
        <div class="task-number">10</div>
        <div class="task-title">Create Background Jobs</div>
        <div class="task-estimate">~1 hour</div>
      </div>
      <div class="task-body">
        <div class="task-section">
          <div class="task-section-title">Description</div>
          <p class="task-description">Create scheduled tasks for sending reminders and expiring applications.</p>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Dependencies</div>
          <span class="dependency-tag dep-task">Task 4</span>
          <span class="dependency-tag dep-task">Task 5</span>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Jobs to Create</div>
          
          <p><strong>send_verification_reminders (runs every hour)</strong></p>
          <ul class="task-list">
            <li>Find applications at 48 hours without verification</li>
            <li>Send reminder email</li>
            <li>Mark reminder as sent (avoid duplicates)</li>
          </ul>
          
          <p><strong>expire_unverified_applications (runs every hour)</strong></p>
          <ul class="task-list">
            <li>Find applications past 72 hours without verification</li>
            <li>Update status to "expired"</li>
            <li>Send expiration notification email</li>
          </ul>
        </div>
        
        <div class="task-section">
          <div class="task-section-title">Acceptance Criteria</div>
          <ul class="checkbox-list">
            <li><input type="checkbox" onchange="updateProgress()"> Reminder job finds correct applications</li>
            <li><input type="checkbox" onchange="updateProgress()"> Expiry job updates status correctly</li>
            <li><input type="checkbox" onchange="updateProgress()"> Jobs can be triggered manually for testing</li>
            <li><input type="checkbox" onchange="updateProgress()"> Jobs are idempotent (safe to run multiple times)</li>
          </ul>
        </div>
        
        <div class="note">
          <strong>Implementation Options:</strong> Use APScheduler, Celery Beat, or simple cron job calling an endpoint. Choose based on existing infrastructure.
        </div>
      </div>
    </div>
    
    <footer>
      <p>EK-SMS Registration Backend Tasks</p>
      <p>Version 1.0 • January 2025</p>
    </footer>
  </div>
  
  <script>
    function updateProgress() {
      const checkboxes = document.querySelectorAll('.checkbox-list input[type="checkbox"]');
      const checked = document.querySelectorAll('.checkbox-list input[type="checkbox"]:checked').length;
      const total = checkboxes.length;
      const percentage = Math.round((checked / total) * 100);
      
      document.getElementById('progressBar').style.width = percentage + '%';
      document.getElementById('completedCount').textContent = checked;
    }
  </script>
</body>
</html>
